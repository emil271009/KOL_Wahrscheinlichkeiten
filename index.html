<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <title>UNO – Wahrscheinlichkeit von Kartenkombinationen</title>
    <link rel="stylesheet" href="UNOstyle.css">
</head>
<body>

<header>
    <h1>UNO – Wahrscheinlichkeit von Kartenkombinationen</h1>
    <p>Berechne die Wahrscheinlichkeit, bestimmte UNO‑Karten oder Muster aus einem 108‑Karten‑Deck zu ziehen.</p>
</header>

<main>

    <!-- ========================================================= -->
    <!-- PROGRAMM 1: Zielkarten + Ausschlusskarten (UNO)           -->
    <!-- ========================================================= -->

    <section class="controls">
        <h2>Zielkarten-Programm (UNO)</h2>

        <div class="control-block">
            <label>Handgröße (Anzahl gezogener Karten):
                <input type="number" id="handSize" min="1" max="108" value="7">
            </label>
        </div>

        <div class="control-block">
            <h3>Karten ausschließen</h3>
			<p>Diese Karten sind nicht mehr im Deck (bereits gesehen oder abgelegt)</p>
            <div id="excludedCardsContainer" class="cards-container"></div>
        </div>

        <div class="control-block">
            <h3>Zielkarten auswählen</h3>
			<p>Diese Karten sollen garantiert in der Hand enthalten sein</p>
            <div id="cardsContainer" class="cards-container"></div>
        </div>

        <button id="calculateButton" class="primary-button">Wahrscheinlichkeit berechnen</button>
    </section>

    <section class="results">
        <h2>Ergebnis</h2>

        <div id="errorMessage" class="message-error hidden"></div>

        <div id="resultContainer" class="message-success hidden">
            <p><strong>Zielkarten:</strong> <span id="selectedCardsText"></span></p>
            <p><strong>Ausgeschlossene Karten:</strong> <span id="excludedCardsText"></span></p>
            <p><strong>Handgröße:</strong> <span id="handSizeText"></span></p>

            <ul>
                <li><strong>Dezimal:</strong> <span id="probabilityDecimal"></span></li>
                <li><strong>Prozent:</strong> <span id="probabilityPercent"></span></li>
                <li><strong>1 zu X:</strong> <span id="probabilityOdds"></span></li>
            </ul>

            <h3>Rechenweg</h3>
            <div id="calculationSteps" class="calculation-box"></div>
        </div>
    </section>


    <!-- ========================================================= -->
    <!-- PROGRAMM 2: X Karten einer Farbe oder eines Werts (UNO)   -->
    <!-- ========================================================= -->

    <section class="controls">
        <h2>Wahrscheinlichkeit für X UNO‑Karten einer Farbe oder eines Werts</h2>

        <div class="control-block">
            <label>Handgröße:
                <input type="number" id="handSize2" min="1" max="108" value="7">
            </label>
        </div>

        <div class="control-block">
            <label>Anzahl gewünschter Karten:
                <input type="number" id="countX" min="0" max="25" value="2">
            </label>
        </div>

        <div class="control-block">
            <label>Art:
                <select id="typeSelect">
                    <option value="color">Farbe (Rot, Gelb, Grün, Blau)</option>
                    <option value="value">Wert (0–9, Skip, Reverse, +2, Wünscher, +4)</option>
                </select>
            </label>
        </div>

        <div class="control-block">
            <label>Konkrete Auswahl:
                <select id="specificSelect"></select>
            </label>
        </div>

        <button id="calculateButton2" class="primary-button">Wahrscheinlichkeit berechnen</button>
    </section>

    <section class="results">
        <h2>Ergebnis – X UNO‑Karten</h2>

        <div id="errorMessage2" class="message-error hidden"></div>

        <div id="resultContainer2" class="message-success hidden">
            <ul>
                <li><strong>Dezimal:</strong> <span id="probabilityDecimal2"></span></li>
                <li><strong>Prozent:</strong> <span id="probabilityPercent2"></span></li>
                <li><strong>1 zu X:</strong> <span id="probabilityOdds2"></span></li>
            </ul>

            <h3>Rechenweg</h3>
            <div id="calculationSteps2" class="calculation-box"></div>
        </div>
    </section>

</main>

<footer>
    <p>UNO‑Wahrscheinlichkeitsrechner – Beispielprojekt</p>
</footer>

<script>
/* ============================================================
   Grund-Hilfsfunktionen
============================================================ */

function combination(n, k) {
    if (k < 0 || k > n) return 0;
    if (k === 0 || k === n) return 1;
    k = Math.min(k, n - k);
    let r = 1;
    for (let i = 1; i <= k; i++) {
        r = r * (n - (k - i)) / i;
    }
    return r;
}

function formatOdds(p) {
    if (p <= 0) return "unmöglich";
    return "1 zu " + (1 / p).toFixed(0);
}

/* ============================================================
   UNO-Deckdefinition
============================================================ */

const UNO_COLORS = ["Rot", "Gelb", "Grün", "Blau"];
const UNO_VALUES = ["0","1","2","3","4","5","6","7","8","9","Skip","Reverse","+2"];
const UNO_BLACK = ["Wünscher","+4"]; // Farbwahl, +4

function createUnoDeck() {
    const deck = [];

    // Farbige Karten
    UNO_COLORS.forEach(color => {
        UNO_VALUES.forEach(value => {
            const count = (value === "0") ? 1 : 2;
            for (let i = 0; i < count; i++) {
                deck.push({
                    id: `${color}_${value}_${i}`,
                    label: `${color} ${value}`,
                    color: color,
                    value: value
                });
            }
        });
    });

    // Schwarze Karten
    UNO_BLACK.forEach(value => {
        for (let i = 0; i < 4; i++) {
            deck.push({
                id: `Schwarz_${value}_${i}`,
                label: value,
                color: "Schwarz",
                value: value
            });
        }
    });

    return deck;
}

/* ============================================================
   DOM-Referenzen
============================================================ */

/* Programm 1 */
const handSize = document.getElementById("handSize");
const calculateButton = document.getElementById("calculateButton");
const errorMessage = document.getElementById("errorMessage");
const resultContainer = document.getElementById("resultContainer");
const cardsContainer = document.getElementById("cardsContainer");
const excludedCardsContainer = document.getElementById("excludedCardsContainer");

const selectedCardsText = document.getElementById("selectedCardsText");
const excludedCardsText = document.getElementById("excludedCardsText");
const handSizeText = document.getElementById("handSizeText");
const probabilityDecimal = document.getElementById("probabilityDecimal");
const probabilityPercent = document.getElementById("probabilityPercent");
const probabilityOdds = document.getElementById("probabilityOdds");
const calculationSteps = document.getElementById("calculationSteps");

/* Programm 2 */
const handSize2 = document.getElementById("handSize2");
const countX = document.getElementById("countX");
const typeSelect = document.getElementById("typeSelect");
const specificSelect = document.getElementById("specificSelect");
const calculateButton2 = document.getElementById("calculateButton2");
const errorMessage2 = document.getElementById("errorMessage2");
const resultContainer2 = document.getElementById("resultContainer2");
const probabilityDecimal2 = document.getElementById("probabilityDecimal2");
const probabilityPercent2 = document.getElementById("probabilityPercent2");
const probabilityOdds2 = document.getElementById("probabilityOdds2");
const calculationSteps2 = document.getElementById("calculationSteps2");

/* ============================================================
   Programm 1 – Karten rendern (UNO)
============================================================ */

function renderUnoCards() {
    const deck = createUnoDeck();

    function createColorRow(container, color) {
        const row = document.createElement("div");
        row.className = "suit-row";

        const label = document.createElement("div");
        label.className = "suit-label";
        label.textContent = color;

        const cardsWrap = document.createElement("div");
        cardsWrap.className = "suit-cards";
        cardsWrap.dataset.color = color;

        row.appendChild(label);
        row.appendChild(cardsWrap);
        container.appendChild(row);

        return cardsWrap;
    }

    const excludedRows = {};
    const targetRows = {};

    [...UNO_COLORS, "Schwarz"].forEach(color => {
        excludedRows[color] = createColorRow(excludedCardsContainer, color);
        targetRows[color] = createColorRow(cardsContainer, color);
    });

    deck.forEach(card => {
        const color = card.color;

        // Ausschlusskarte
        const w2 = document.createElement("label");
        w2.className = "card-checkbox card-excluded";
        w2.dataset.cardId = card.id;

        const c2 = document.createElement("input");
        c2.type = "checkbox";
        c2.value = card.id;

        const s2 = document.createElement("span");
        s2.textContent = card.label;

        w2.appendChild(c2);
        w2.appendChild(s2);
        excludedRows[color].appendChild(w2);

        // Zielkarte
        const w1 = document.createElement("label");
        w1.className = "card-checkbox";
        w1.dataset.cardId = card.id;

        const c1 = document.createElement("input");
        c1.type = "checkbox";
        c1.value = card.id;

        const s1 = document.createElement("span");
        s1.textContent = card.label;

        w1.appendChild(c1);
        w1.appendChild(s1);
        targetRows[color].appendChild(w1);

        // Ausschluss beeinflusst Zielkarte
        c2.addEventListener("change", () => updateCardAvailability(card.id, c2.checked));

        // Limit
        c1.addEventListener("change", limitTargetSelection);
    });
}

renderUnoCards();

/* ============================================================
   Programm 1 – Logik
============================================================ */

function updateCardAvailability(cardId, isExcluded) {
    const targetCard = cardsContainer.querySelector(`[data-card-id="${cardId}"]`);
    if (!targetCard) return;

    const checkbox = targetCard.querySelector("input");

    if (isExcluded) {
        checkbox.checked = false;
        checkbox.disabled = true;
        targetCard.classList.add("card-unavailable");
    } else {
        checkbox.disabled = false;
        targetCard.classList.remove("card-unavailable");
    }

    limitTargetSelection();
}

function limitTargetSelection() {
    const max = parseInt(handSize.value, 10);
    const selected = cardsContainer.querySelectorAll("input:checked").length;

    cardsContainer.querySelectorAll(".card-checkbox").forEach(card => {
        const checkbox = card.querySelector("input");

        if (card.classList.contains("card-unavailable")) {
            checkbox.disabled = true;
            return;
        }

        if (checkbox.checked) {
            checkbox.disabled = false;
            card.classList.remove("card-limit");
            return;
        }

        if (selected >= max) {
            checkbox.disabled = true;
            card.classList.add("card-limit");
        } else {
            checkbox.disabled = false;
            card.classList.remove("card-limit");
        }
    });
}

calculateButton.addEventListener("click", () => {
    const n = parseInt(handSize.value, 10);

    const selected = Array.from(cardsContainer.querySelectorAll("input:checked"));
    const excluded = Array.from(excludedCardsContainer.querySelectorAll("input:checked"));

    const k = selected.length;
    const e = excluded.length;

    errorMessage.classList.add("hidden");
    resultContainer.classList.add("hidden");

    const available = 108 - e;

    if (available < n) {
        errorMessage.textContent = "Nicht genug Karten im Deck.";
        errorMessage.classList.remove("hidden");
        return;
    }

    const favorable = combination(available - k, n - k);
    const total = combination(available, n);
    const p = favorable / total;

    selectedCardsText.textContent = selected.map(c => c.value).join(", ") || "Keine";
    excludedCardsText.textContent = excluded.map(c => c.value).join(", ") || "Keine";
    handSizeText.textContent = n;

    probabilityDecimal.textContent = p.toExponential(6);
    probabilityPercent.textContent = (p * 100).toExponential(6) + " %";
    probabilityOdds.textContent = formatOdds(p);

    calculationSteps.innerHTML = `
        <p>P = C(${available - k}, ${n - k}) / C(${available}, ${n})</p>
        <p>P = ${favorable.toLocaleString("de-DE")} / ${total.toLocaleString("de-DE")}</p>
        <p><strong>P = ${p.toExponential(6)}</strong></p>
    `;

    resultContainer.classList.remove("hidden");
});

/* ============================================================
   Programm 2 – UNO-Farben / Werte
============================================================ */

function updateSpecificSelect() {
    specificSelect.innerHTML = "";

    if (typeSelect.value === "color") {
        UNO_COLORS.forEach(color => {
            const opt = document.createElement("option");
            opt.value = color;
            opt.textContent = color;
            specificSelect.appendChild(opt);
        });
        countX.max = 25; // 25 farbige Karten pro Farbe
        if (parseInt(countX.value, 10) > 25) countX.value = 25;

    } else {
        [...UNO_VALUES, ...UNO_BLACK].forEach(v => {
            const opt = document.createElement("option");
            opt.value = v;
            opt.textContent = v;
            specificSelect.appendChild(opt);
        });
        // Maximal mögliche Anzahl eines Werts:
        //  "0"  -> 4 (eine pro Farbe)
        //  farbige 1–9, Skip, Reverse, +2 -> 8 (2 pro Farbe)
        //  "Wünscher", "+4" -> 4
        countX.max = 8;
        if (parseInt(countX.value, 10) > 8) countX.value = 8;
    }
}

updateSpecificSelect();
typeSelect.addEventListener("change", updateSpecificSelect);

/* Programm 2 – Berechnung */

calculateButton2.addEventListener("click", () => {
    const n = parseInt(handSize2.value, 10);
    const x = parseInt(countX.value, 10);
    const type = typeSelect.value;
    const chosen = specificSelect.value;

    errorMessage2.classList.add("hidden");
    resultContainer2.classList.add("hidden");

    if (n > 108) {
        errorMessage2.textContent = "Handgröße darf nicht größer als 108 sein.";
        errorMessage2.classList.remove("hidden");
        return;
    }

    let groupSize = 0;

    if (type === "color") {
        groupSize = 25; // 0..9 + 3 Aktionskarten -> 25 farbige Karten pro Farbe
        if (x > groupSize) {
            errorMessage2.textContent = "Es gibt nicht so viele Karten dieser Farbe im Deck.";
            errorMessage2.classList.remove("hidden");
            return;
        }
    } else {
        if (chosen === "0") {
            groupSize = 4; // eine 0 pro Farbe
        } else if (UNO_BLACK.includes(chosen)) {
            groupSize = 4; // 4 Wünscher, 4 +4
        } else {
            groupSize = 8; // alle anderen farbigen Werte / Aktionskarten
        }
        if (x > groupSize) {
            errorMessage2.textContent = "Es gibt nicht so viele Karten dieses Werts im Deck.";
            errorMessage2.classList.remove("hidden");
            return;
        }
    }

    const otherSize = 108 - groupSize;

    const favorable =
        combination(groupSize, x) * combination(otherSize, n - x);

    const total = combination(108, n);
    const p = favorable / total;

    probabilityDecimal2.textContent = p.toExponential(6);
    probabilityPercent2.textContent = (p * 100).toExponential(6) + " %";
    probabilityOdds2.textContent = formatOdds(p);

    calculationSteps2.innerHTML = `
        <p>Auswahl: ${type === "color" ? "Farbe" : "Wert"} = <strong>${chosen}</strong></p>
        <p>Gruppengröße (Karten dieser Art im Deck): ${groupSize}</p>
        <p>P = [C(${groupSize}, ${x}) × C(${otherSize}, ${n - x})] / C(108, ${n})</p>
        <p>P = ${favorable.toLocaleString("de-DE")} / ${total.toLocaleString("de-DE")}</p>
        <p><strong>P = ${p.toExponential(6)}</strong></p>
    `;

    resultContainer2.classList.remove("hidden");
});
</script>

</body>
</html>
